# Configuration Directory

This directory contains configuration files for the TARSy application.

üìñ **See also**: [deploy/README.md](../deploy/README.md) for deployment instructions

## OAuth2 Proxy Configuration

### Template System

The OAuth2 proxy uses a **template-based configuration system**:

- **`oauth2-proxy-container.cfg.template`** - Template file (tracked in git)
  - Edit this file to customize your deployment
  - Contains placeholders like `{{ROUTE_HOST}}` that are replaced during deployment
  
- **`oauth2-proxy-container.cfg`** - Generated file (ignored by git)
  - Auto-generated from the template by `make` commands
  - **Do not edit this file directly** - it gets regenerated on every deployment!

### Customizing for Your Deployment

‚ö†Ô∏è **IMPORTANT**: The template file is tracked in git. **Never commit secrets to the template!**  
All sensitive values are provided via **environment variables**.

#### 1. Required Environment Variables (Secrets)

These **MUST** be set before deployment:

```bash
# Quick setup: Use the example file
cp config/oauth.env.example config/oauth.env
vim config/oauth.env  # Edit with your values
make containers-deploy  # Automatically loads config/oauth.env!

# OR export manually if you prefer:
export OAUTH2_CLIENT_ID="your-github-oauth-client-id"
export OAUTH2_CLIENT_SECRET="your-github-oauth-client-secret"
export GITHUB_ORG="your-organization"  # Optional
export GITHUB_TEAM="your-team"         # Optional
```

üí° **Tip**: The Makefile **automatically loads** `config/oauth.env` if it exists - no need to manually source it!

#### 2. Environment-Specific Values (Automatic)

These are handled automatically by the Makefile:

| Variable | Local Default | OpenShift | Override Example |
|----------|---------------|-----------|------------------|
| `ROUTE_HOST` | `localhost:8080` | Route hostname | `make ROUTE_HOST=myhost.com containers-deploy` |
| `COOKIE_SECURE` | `false` (HTTP) | `true` (HTTPS) | `make COOKIE_SECURE=true containers-deploy` |

### Setting Up GitHub OAuth

1. Go to https://github.com/settings/developers
2. Click "New OAuth App"
3. Fill in:
   - **Application name**: TARSy (or your preferred name)
   - **Homepage URL**: `http://localhost:8080` (or your deployment URL)
   - **Authorization callback URL**: `http://localhost:8080/oauth2/callback`
4. Copy the Client ID and Client Secret
5. Export as environment variables:
   ```bash
   export OAUTH2_CLIENT_ID="your-client-id-here"
   export OAUTH2_CLIENT_SECRET="your-client-secret-here"
   export GITHUB_ORG="your-org"
   export GITHUB_TEAM="your-team"
   ```
6. Deploy: `make containers-deploy`

### Managing Secrets Securely

‚úÖ **Best Practice**: All secrets are provided via environment variables  
‚úÖ **Safe to commit**: The template file contains only placeholders  
‚úÖ **No git history**: Secrets never appear in your repository

For different environments:

- **Development**: Export variables in your shell or add to `~/.bashrc` / `~/.zshrc`
- **Production**: Use a secret manager (HashiCorp Vault, AWS Secrets Manager, etc.)
- **CI/CD**: Configure as encrypted environment variables in your pipeline
- **Team sharing**: Share client IDs via secure channels (1Password, LastPass, etc.)

### How Deployment Works

When you run `make containers-deploy` or similar commands:

1. `check-config` target is called
2. **Environment variables are validated** (OAUTH2_CLIENT_ID, OAUTH2_CLIENT_SECRET required)
3. Template is read from `oauth2-proxy-container.cfg.template`
4. **Placeholders are replaced** with environment variable values:
   - `{{ROUTE_HOST}}` ‚Üí `localhost:8080`
   - `{{COOKIE_SECURE}}` ‚Üí `false`
   - `{{OAUTH2_CLIENT_ID}}` ‚Üí Your client ID from env
   - `{{OAUTH2_CLIENT_SECRET}}` ‚Üí Your secret from env
   - `{{GITHUB_ORG}}` ‚Üí Your org from env (or "your-org" placeholder)
   - `{{GITHUB_TEAM}}` ‚Üí Your team from env (or "your-team" placeholder)
5. Generated config is written to `oauth2-proxy-container.cfg`
6. Containers are deployed with the generated config

## Other Configuration Files

- **`llm_providers.yaml`** - LLM provider configurations (optional)
- **`agents.yaml`** - Agent configurations (optional)
- **`keys/`** - JWT signing keys for API authentication
- **`templates/`** - Custom OAuth2 proxy HTML templates

All YAML configs are optional - built-in defaults are used if not present.

